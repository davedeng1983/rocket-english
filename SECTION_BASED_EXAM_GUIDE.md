# 📚 按部分考试功能说明

## 功能概述

现在系统支持**按部分进行考试**，学生可以：
- 只做单项选择部分
- 只做完形填空部分
- 只做阅读理解部分
- 或者完成整个试卷

系统会自动**记录用户完成了哪些部分**，方便碎片化时间学习。

---

## 🎯 使用流程

### 1. 查看试卷概览

打开试卷后，会看到试卷结构，包括：
- 单项选择
- 完形填空
- 阅读理解
- 阅读表达
- 书面表达

每个部分显示：
- ✅ **已完成**：绿色标记，表示已经完成
- ⏯️ **未完成**：蓝色按钮，可以点击开始

### 2. 选择部分开始考试

点击任意部分（例如"单项选择"）：
- 系统只加载该部分的题目
- 直接开始考试，无需做完整试卷
- 适合碎片化时间学习

### 3. 完成后的状态

完成某个部分后：
- 系统自动记录完成状态
- 在试卷概览页面显示"已完成"标记
- 可以继续完成其他部分
- 也可以完成整个试卷

---

## 📊 数据库迁移

### 需要执行的 SQL

为了支持按部分考试功能，需要在数据库中添加 `section_type` 字段：

```sql
-- 为 user_exam_attempts 表添加 section_type 字段
ALTER TABLE user_exam_attempts 
ADD COLUMN IF NOT EXISTS section_type TEXT; -- 'single_choice', 'cloze', 'reading', 'writing', 'full' (整卷)

-- 创建索引以优化按部分查询
CREATE INDEX IF NOT EXISTS idx_attempts_section ON user_exam_attempts(paper_id, user_id, section_type);

-- 刷新 schema 缓存
NOTIFY pgrst, 'reload config';
```

### 执行步骤

1. 打开 Supabase Dashboard
2. 进入 SQL Editor
3. 复制上面的 SQL 代码
4. 执行 SQL

迁移脚本已保存到：`supabase/migrations/add_section_type_to_attempts.sql`

---

## 🔧 技术实现

### 1. 数据库字段

在 `user_exam_attempts` 表中添加了：
- `section_type`: 记录是哪个部分的考试

可能的值：
- `'single_choice'`: 单项选择
- `'cloze'`: 完形填空
- `'reading'`: 阅读理解
- `'writing'`: 书面表达
- `'full'`: 整卷考试

### 2. API 端点

新增 API：
- `GET /api/exam-papers/[id]/completed-sections`：查询用户完成了哪些部分

### 3. 组件修改

- **ExamRunner**：
  - 支持 `sectionType` 参数，只加载指定部分的题目
  - 提交时自动记录 `section_type`
  - 试卷概览页面显示完成状态

### 4. 完成状态追踪

系统会：
- 自动查询用户完成了哪些部分
- 在试卷概览页面实时显示完成状态
- 提交完成后自动刷新状态

---

## 💡 使用场景

### 场景 1：碎片化学习

学生只有 5 分钟时间：
- 选择"单项选择"部分
- 完成 12 道题目
- 系统记录完成状态

### 场景 2：分步完成

学生分多次完成试卷：
- 第一天完成单项选择
- 第二天完成完形填空
- 第三天完成阅读理解
- 系统记录每一步的完成状态

### 场景 3：针对性练习

学生想专门练习某个部分：
- 只做阅读理解部分
- 查看详细结果和解析
- 系统记录完成状态，方便后续复习

---

## ✨ 功能特点

- ✅ **碎片化学习**：支持分部分完成，适合零碎时间
- ✅ **进度追踪**：自动记录完成状态，一目了然
- ✅ **灵活选择**：可以只做部分，也可以做整卷
- ✅ **状态显示**：清晰标记已完成和未完成的部分
- ✅ **无缝切换**：可以在部分和整卷之间自由切换

---

## 📝 注意事项

1. **数据库迁移**：需要执行 SQL 迁移脚本才能使用此功能
2. **完成判断**：完成某个部分后，在试卷概览页面会显示"已完成"标记
3. **分数计算**：每个部分的分数是独立计算的
4. **错题归因**：每个部分的错题归因是独立的

---

## 🚀 下一步

现在可以：
1. 执行数据库迁移
2. 测试按部分考试功能
3. 查看完成状态显示

如果遇到任何问题，请告诉我！
