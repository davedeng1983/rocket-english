# 试卷导入功能使用指南

## 功能概述

系统支持每周自由导入 Word 版中考真题试卷，导入后会自动执行以下操作：

1. ✅ **自动解析** Word 文档，提取题目、选项
2. ✅ **自动识别** 知识点并建立关联
3. ✅ **自动入库** 到数据库（试卷、题目、知识边）
4. ✅ **立即可用** 导入后即可在"开始测试"页面看到新试卷

## 使用步骤

### 1. 访问导入页面

- 登录系统后，访问 `/import` 页面
- 或在首页点击"📥 导入试卷"按钮

### 2. 选择 Word 文档

- 点击"选择 Word 文档"按钮
- 选择 `.docx` 或 `.doc` 格式的文件
- 系统会显示文件名和大小

### 3. 开始导入

- 点击"开始导入"按钮
- 系统会自动解析文档
- 显示导入进度和结果

### 4. 查看结果

导入成功后，会显示：
- ✅ 试卷标题
- ✅ 题目数量
- ✅ 知识点关联数量
- ✅ 可以立即开始测试

## Word 文档格式要求

### 推荐格式

```
1. 题干内容 A. 选项A B. 选项B C. 选项C D. 选项D
2. 题干内容 A. 选项A B. 选项B C. 选项C D. 选项D
...
```

### 格式说明

- **题号**：数字 + 点号（如 `1.`、`2.`）
- **题干**：题号后的文本内容
- **选项**：A.、B.、C.、D. 开头的选项
- **标题**：文档开头可以包含试卷标题（如"2022年北京市中考英语真题"）

### 示例

```
2022年北京市中考英语真题

1. My friends and I like sports. ____ often play basketball together after school.
A. We
B. I
C. They
D. You

2. Chinese ____ by more people these days.
A. speaks
B. spoke
C. is spoken
D. was spoken
```

## 自动化流程

导入后，系统会自动执行：

### 1. 文档解析
- 使用 `mammoth` 库解析 Word 文档
- 提取纯文本内容
- 识别题目、选项、标题

### 2. 信息提取
- **试卷标题**：从文档中提取或使用文件名
- **年份**：自动识别（如"2022年"）
- **地区**：自动识别（如"北京"、"上海"）

### 3. 题目识别
- 使用正则表达式匹配题目格式
- 提取题号、题干、选项
- 自动分类为"单选题"

### 4. 知识点识别
- 分析题目内容（题干 + 选项）
- 匹配关键词规则
- 自动关联知识点

### 5. 数据入库
- 创建 `exam_papers` 记录
- 批量创建 `questions` 记录
- 创建 `content_knowledge_edges` 关联

## 知识点自动识别规则

系统会根据题目内容自动识别以下知识点：

| 知识点 | 关键词示例 | 置信度 |
|--------|-----------|--------|
| 人称代词主格 | I, you, he, she, we, they | 0.8 |
| 被动语态 | is spoken, was done, be made | 0.9 |
| 一般过去时 | yesterday, last week, was, were | 0.8 |
| 一般将来时 | will, going to, next week | 0.8 |
| 一般现在时 | every day, often, usually | 0.7 |
| L3 词汇 | confident, ambition, strategy | 0.6 |
| L2 词汇 | interesting, excited | 0.6 |
| 阅读理解 | read, passage, article | 0.7 |

## 注意事项

### 1. 文件格式
- ✅ 支持 `.docx` 和 `.doc` 格式
- ❌ 不支持 `.pdf`、`.txt` 等其他格式

### 2. 文档格式
- 建议使用标准格式（题号. 题干 A. 选项...）
- 如果格式不标准，可能无法正确提取题目
- 可以手动调整 Word 文档格式后重新导入

### 3. 题目数量
- 系统会提取所有匹配格式的题目
- 如果导入后题目数量为 0，请检查文档格式

### 4. 知识点识别
- 当前使用关键词匹配，准确率约 70-90%
- 如果识别不准确，可以在数据库中手动调整
- 未来可以集成 AI 模型提高准确率

### 5. 正确答案
- 导入时不会自动识别正确答案
- 需要手动在数据库中补充 `correct_answer` 字段
- 或通过后续的"答案解析"功能添加

## 故障排查

### 问题 1：导入失败
- **原因**：文件格式不支持或文档格式不正确
- **解决**：检查文件是否为 `.docx` 或 `.doc` 格式，检查文档格式是否符合要求

### 问题 2：题目数量为 0
- **原因**：文档格式不匹配正则表达式
- **解决**：调整文档格式，确保题号、选项格式正确

### 问题 3：知识点识别不准确
- **原因**：关键词匹配规则有限
- **解决**：可以在数据库中手动调整 `content_knowledge_edges` 表

## 未来优化方向

1. **AI 增强识别**
   - 使用 GPT/Claude 等模型识别知识点
   - 提高识别准确率到 95%+

2. **多格式支持**
   - 支持 PDF 格式
   - 支持图片识别（OCR）

3. **批量导入**
   - 支持一次导入多个文件
   - 支持文件夹批量导入

4. **智能解析**
   - 自动识别完形填空、阅读理解等题型
   - 自动提取正确答案

5. **预览功能**
   - 导入前预览解析结果
   - 可以手动调整后再确认导入

## 相关文件

- `app/import/page.tsx` - 导入页面
- `app/api/import-paper/route.ts` - 导入 API
- `lib/utils/wordParser.ts` - Word 解析工具（已删除，功能整合到 API）
- `lib/utils/knowledgeExtractor.ts` - 知识点提取工具（已删除，功能整合到 API）

